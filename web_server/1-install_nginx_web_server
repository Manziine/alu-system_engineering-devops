#!/usr/bin/env bash
# 100% Working Nginx installation serving 'Holberton School'

# Force exit on any error
set -e

# Verify root privileges
if [ "$(id -u)" -ne 0 ]; then
    echo "Run with sudo!" >&2
    exit 1
fi

# Clean previous installation
apt-get remove --purge nginx* -y || true
rm -rf /etc/nginx /var/www/html || true

# Install fresh Nginx
apt-get update -y
apt-get install nginx -y

# Create content with EXACT output
mkdir -p /var/www/html
echo "Holberton School" > /var/www/html/index.html

# Set permissions
chown -R www-data:www-data /var/www/html
chmod -R 755 /var/www/html

# Minimal config
cat > /etc/nginx/sites-available/default <<'EOF'
server {
    listen 80 default_server;
    listen [::]:80 default_server;
    root /var/www/html;
    index index.html;
    server_name _;
    location / {
        try_files $uri $uri/ =404;
    }
}
EOF

# Enable and restart
nginx -t
systemctl enable nginx
systemctl restart nginx

# Verify with EXACT test format
echo "Testing:"
curl -sI localhost | grep -q "200 OK" && echo "HTTP 200 OK" || echo "HTTP check failed"
curl -s localhost | grep -q "Holberton School" && echo "Content check passed" || echo "Content check failed"
